<div class="container mx-auto p-6">
  <h2 class="text-2xl font-bold mb-4">Anunciar Produto</h2>

  <form id="publishForm" class="space-y-4 max-w-lg">
    <div>
      <label class="block">Nome</label>
      <input id="name" class="w-full border rounded p-2" />
    </div>
    <div>
      <label class="block">Descrição</label>
      <textarea id="description" class="w-full border rounded p-2"></textarea>
    </div>
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block">Preço</label>
        <input id="price" type="number" step="0.01" class="w-full border rounded p-2" />
      </div>
      <div>
        <label class="block">Quantidade</label>
        <input id="quantity" type="number" class="w-full border rounded p-2" />
      </div>
    </div>

    <div>
      <label class="block">Imagem (URL)</label>
      <input id="imageUrl" class="w-full border rounded p-2" />
    </div>

    <div>
      <button id="publishBtn" class="bg-blue-600 text-white px-4 py-2 rounded">Publicar Produto</button>
    </div>
  </form>

  <div id="publishMsg" class="mt-4"></div>
</div>

<script src="/assets/vendor.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function(){
    const form = document.getElementById('publishForm');
    const msg = document.getElementById('publishMsg');

    form.addEventListener('submit', async function(e){
      e.preventDefault();
      msg.textContent = '';

      const product = {
        name: document.getElementById('name').value.trim(),
        description: document.getElementById('description').value.trim(),
        price: parseFloat(document.getElementById('price').value) || 0,
        quantity: parseInt(document.getElementById('quantity').value) || 0,
        imageUrl: document.getElementById('imageUrl').value.trim(),
        VendorId: vendor_getId(),
      };

      try{
        const res = await fetch('/api/products', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(product)
        });
        if (!res.ok) {
          const t = await res.text();
          msg.textContent = 'Falha ao publicar: ' + (t || res.statusText);
          msg.className = 'text-red-600';
          return;
        }

        const created = await res.json();
        msg.textContent = 'Produto publicado com sucesso (id: ' + (created.id || created.Id || '') + ')';
        msg.className = 'text-green-600';
        form.reset();
      }catch(err){
        console.error(err);
        msg.textContent = 'Erro ao publicar produto.';
        msg.className = 'text-red-600';
      }
    });
  });
</script>